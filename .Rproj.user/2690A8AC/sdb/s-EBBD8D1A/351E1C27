{
    "collab_server" : "",
    "contents" : "library(readr)\nlibrary(dplyr)\nlibrary(quantmod)\n\n#import data\nOHLC <- read_csv(\"C:/Users/chang/Desktop/TEMP/OHLC.csv\")\nthree_legals <- read_csv(\"C:/Users/chang/Desktop/TEMP/三大法人.csv\")\n#clean\nOHLC = OHLC[,c(-4,-10)]\n#join\njoined_frame = inner_join(OHLC,three_legals,by=c(\"stkno\",\"Date\"))\n#遺漏值處理 NA to 0\njoined_frame[is.na(joined_frame)] <- 0\n\n#joined_frame$Date = as.Date(joined_frame$Date, format= \"%Y-%d-%m\")\n#a = joined_frame[grep(\"2017-06-01\", joined_frame$Date),]\n\n#get all stkno\nstkno_all = unique(joined_frame$stkno)\n\n\n#計算黃金&死亡交叉\n#取單股 (0050)\nstkno_0050 = OHLC[grep(\"0050\", OHLC$stkno),]\n#為建立 XTS物件做的處理\nstkno_0050 = stkno_0050[,c(-1,-8)]\ncolnames(stkno_0050) <- c(\"Date\",\"Volume\",\"Open\",\"High\",\"Low\",\"Close\")\nstkno_0050 = stkno_0050[,c(\"Date\",\"Open\",\"High\",\"Low\",\"Close\",\"Volume\")]\n\n#建立XTS物件\nstk0050 = xts(stkno_0050[, -1], order.by=as.POSIXct(stkno_0050$Date))\n\n\n#1 K線圖，量，MA10，MA20\nchartSeries(stk0050,subset=\"last 3 months\",theme=\"white\", up.col='red', dn.col='green')\naddSMA(10,col=\"blue\")\naddSMA(20,col=\"red\")\n\n\n#2.0 去除量的圖 加上回測資產圖  中程\nchartSeries(stk0050['2005-06-30/2016-12-31'],theme=\"white\", up.col='red', dn.col='green',TA=NULL)\nfastMA<-runMean(stk0050[,4],n=20)\nslowMA<-runMean(stk0050[,4],n=60)\naddTA(fastMA,on=1,col=\"blue\")\naddTA(slowMA,on=1,col=\"red\")\nposition<-Lag(ifelse(fastMA>=slowMA, 1,0))\nreturn<-ROC(Cl(stk0050))*position\nreturn <- return['2005-06-30/2016-12-31']\neq <- exp(cumsum(return))\naddTA(eq)\n#zoomChart('2012-10::2013-12') \n#plot(eq)\n\n#2.1 去除量的圖 加上回測資產圖  中程\nchartSeries(stk0050['2003-06-30/2013-12-31'],theme=\"white\", up.col='red', dn.col='green',TA=NULL)\nfastMA<-runMean(stk0050[,4],n=20)\nslowMA<-runMean(stk0050[,4],n=60)\naddTA(fastMA,on=1,col=\"blue\")\naddTA(slowMA,on=1,col=\"red\")\nposition<-Lag(ifelse(fastMA>=slowMA, 1,0))\nreturn<-ROC(Cl(stk0050))*position\nreturn <- return['2006-06-30/2013-12-31']\neq <- exp(cumsum(return))\naddTA(eq)\nzoomChart('2012-10::2013-12') \naddTA(fastMA-slowMA)\n\n\n\n#2.1.2 去除量的圖 加上回測資產圖  中程\nchartSeries(stk0050['2003-06-30/2013-12-31'],theme=\"white\", up.col='red', dn.col='green',TA=NULL)\nfastMA<-runMean(stk0050[,4],n=5)\nslowMA<-runMean(stk0050[,4],n=20)\naddTA(fastMA,on=1,col=\"blue\")\naddTA(slowMA,on=1,col=\"red\")\nposition<-Lag(ifelse(fastMA>=slowMA, 1,0))\nreturn<-ROC(Cl(stk0050))*position\nreturn <- return['2006-06-30/2013-12-31']\neq <- exp(cumsum(return))\naddTA(eq)\nzoomChart('2012-10::2013-12') \naddTA(fastMA-slowMA)\n\n\n\n\n#3.0 \nchartSeries(stk0050['2007-03-30/2017-06-14'],theme=\"white\", up.col='red', dn.col='green',TA=NULL)\nfastMA<-runMean(stk0050[,4],n=5)\nslowMA<-runMean(stk0050[,4],n=20)\naddTA(fastMA,on=1,col=\"blue\")\naddTA(slowMA,on=1,col=\"red\")\nposition<-Lag(ifelse(fastMA>=slowMA, 1,0))\nreturn<-ROC(Cl(stk0050))*position\nreturn <- return['2007-03-30/2017-06-14']\neq <- exp(cumsum(return))\naddTA(eq)\n\n#ZOOM IN\nzoomChart('2012-10::2013-12') \naddTA(fastMA-slowMA)\n\n\n\n#3 計算個股資產\n\nadd_special <- function(a, b){\n  \n  fastMA<-runMean(stk0050[,4],n=5)\n  slowMA<-runMean(stk0050[,4],n=20)\n\n  position<-Lag(ifelse(fastMA>=slowMA, 1,0))\n  return<-ROC(Cl(stk0050))*position\n  return = return[complete.cases(return),]\n  eq <- exp(cumsum(return))\n  \n  c = a + b\n  return(0) # 可以自訂要回傳的部份\n}\n\n\n\nchartSeries(stk0050['2016-09-01/2017-06-01'],theme=\"white\")\naddTA(fastMA ,on=1,col=\"blue\")\naddTA(slowMA,on=1,col=\"red\")\naddTA(fastMA-slowMA)\n\n\n\naddTA(stk0050[buy(position),\"stk0050.Low\"] , pch = 2, type = \"p\", col = \"red\", on = 1)\naddTA(stk0050[sell(position),\"stk0050.High\"] , pch = 6, type = \"p\", col = \"green\", on = 1)\n\nstk0050[buy(position),\"stk0050.Low\"]- 30\n\n",
    "created" : 1497990496069.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "30357056",
    "id" : "351E1C27",
    "lastKnownWriteTime" : 1497702647,
    "last_content_update" : 1497702647,
    "path" : "C:/Users/chang/Desktop/TEMP/fianl.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}